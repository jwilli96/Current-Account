<!DOCTYPE html>
<html>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<script type="text/javascript" src="https://canvasjs.com/assets/script/jquery-1.11.1.min.js"></script>
<script type="text/javascript" src="https://canvasjs.com/assets/script/canvasjs.min.js"></script> 
 <input type="hidden" value="1" id="total_chq">
<body>
    <div id="container"></div>
</body>

 <table id="table1">
    <tbody>
         <tr><td><label for="Leg-Options">Leg1:</label></td>
			<td><select id = "column1" style="width: 110px" onchange="addColumn(event)">
  					<option>Add Leg</option>
  					<option>Duplicate Leg</option>
 					<option>Remove Leg</option>
				</select>
			</td>
		</tr>

            
			<tr><td><label for="myDirection">Direction</label></td><td><select id = "direction1" style="width: 110px">
  				<option value='0'>Buy</option>
 				<option value='1'>Sell</option>
			</select></td></tr>
			
			<tr><td><label for="CallPut">Call/Put</label></td><td><select id = "CallPut1" style="width: 110px">
  				<option value='0'>Call</option>
 				<option value='1'>Put</option>
			</select></td></tr>
			
            <tr><td><label for="spot">Spot:</label></td><td><input id="1" type="text" name="t1"></td></tr>
            <tr><td><label for="time to maturity">Maturity:</label></td><td><input id="2"  type="text" name="t2"></td></tr>
            <tr><td><label for="notional">Notional:</label></td><td><input id="3"  type="text" name="t3"></td></tr>
            <tr><td><label for="strike">Stike:</label></td><td><input id="4"  type="text" name="t4"></td></tr>
            <tr><td><label for="ivol">ivol:</label></td><td><input id="5"  type="text" name="t5"></td></tr>
            <tr><td><label for="option price">Option Price:</label></td><td><input id="6"  type="text" name="t6"></td></tr>
    </tbody>
  </table>
  
   <table id="table2">
    <tbody>
    		<td bgcolor="#FFFFFF" style="line-height:10px;" colspan=3>&nbsp;</td>
            <tr><td><label for="spot min">Spot min:</label></td><td><input id="spotMin"  type="text" name="t7"></td></tr>
            <tr><td><label for="spot max">Spot max:</label></td><td><input id="spotMax"  type="text" name="t8"></td></tr>
    </tbody>
  </table>
  
      <body>  
<div id="chartContainer" style="width:100%; height:280px"></div>  
<button id="updateDataPoint">Update Data Point</button>  
</body>

  <script language="javascript" type="text/javascript">
  
  function addColumn(evt) {
	  var j = 0;
	  var k = 0;
	  var m = 0;
	  var rowCount = 8;
	  var k = rowCount + 1;
	  var saved = '';
	  var lastActiveToolIdFull = evt.target.id;
	  var lastActiveToolIdShort = lastActiveToolIdFull.substring(lastActiveToolIdFull.length - 1);

	  if (evt.target.value === "Duplicate Leg") {
		    
		  //increase leg count by 1
			var new_chq_no = parseInt($('#total_chq').val())+1;
		    var new_input="<input type='text' id='new_"+new_chq_no+"'>";
		    $('#new_chq').append(new_input);
		    $('#total_chq').val(new_chq_no)
				    
			for (const [i, row] of [...document.querySelectorAll('#table1 tr')].entries()) {
				// add the Leg dropdown to the first row of the new column
				if (i == 0) {							
					saved = $("#column1").clone().attr("id","myList" + last_chq_no);
					saved.attr("id", "column" + new_chq_no);
					const cell = document.createElement(i ? "td" : "th")
					saved.appendTo(cell);
					row.appendChild(cell)	
				// add the Direction dropdown to the second row of the new column		
				}
				else if (i == 1) {
					direction = $("#direction1").clone().attr("id","direction" + last_chq_no);
					direction.attr("id", "direction" + new_chq_no);
					
					var selectTest = document.getElementById('direction1');			
					dropdownSelected = selectTest.selectedIndex;
					direction[0].value = dropdownSelected;

					const cellOne = document.createElement(i ? "td" : "th")
					direction.appendTo(cellOne);
					row.appendChild(cellOne)

					
				}
				// add the CallPut dropdown to the third row of the new column
				else if (i == 2) {
					callPut = $("#CallPut1").clone().attr("id","CallPut" + last_chq_no);
					callPut.attr("id", "CallPut" + new_chq_no);
					
					var callPutTest = document.getElementById('CallPut1');				
					callPutSelected = callPutTest.selectedIndex;
					callPut[0].value = callPutSelected;
								
					const cellTwo = document.createElement(i ? "td" : "th")
					callPut.appendTo(cellTwo);
					row.appendChild(cellTwo)
				}
				// add textboxes from row 4 until last row in table
				else {
					//if it's the second column take values from the first column
					if (new_chq_no == 2) {
						j++;
		  				const input = document.createElement("input")
		  				input.setAttribute("id", j + rowCount, "class", "secure");
		  				input.value = document.getElementById(j).value;
		    			const cell = document.createElement(i ? "td" : "th")
		    			cell.appendChild(input)   
		    			row.appendChild(cell)
					}
   					// if it's any other column take the previous columns values
					else {
		  				k++;
		  				m++;
		  				const input = document.createElement("input")
		  				input.setAttribute("id", (rowCount * (new_chq_no - 2)) + (k - 1), "class", "secure");
		  				input.value = document.getElementById(rowCount * (lastActiveToolIdShort - 1) + m).value;
		    			const cell = document.createElement(i ? "td" : "th")
		    			cell.appendChild(input)   
		    			row.appendChild(cell)

					}
				}
    			
  		}

	}

		else if (evt.target.value === "Remove Leg") {
			var last_chq_no = $('#total_chq').val();
			//only remove leg if the number of legs > 1
			if(last_chq_no > 1){
			  var allRows = document.getElementById('table1').rows;
			  for (var i=0; i< allRows.length; i++) {
			    allRows[i].deleteCell(-1); 
			  }
			  //decrease leg count by 1
				var new_chq_no = parseInt($('#total_chq').val())-1;
			    var new_input="<input type='text' id='new_"+new_chq_no+"'>";
			    $('#new_chq').append(new_input);
			    $('#total_chq').val(new_chq_no)
			  }

		}
		else {
			 
			//increase leg count by 1
			var new_chq_no = parseInt($('#total_chq').val())+1;
		    var new_input="<input type='text' id='new_"+new_chq_no+"'>";
		    $('#new_chq').append(new_input);
		    $('#total_chq').val(new_chq_no)
			
			for (const [i, row] of [...document.querySelectorAll('#table1 tr')].entries()) {
				// add dropdown to the first row of the new column
				if (i == 0) {	
					saved = $("#column1").clone().attr("id","myList" + last_chq_no);
					saved.attr("id", "column" + new_chq_no);
					const cell = document.createElement(i ? "td" : "th")
					saved.appendTo(cell);
					row.appendChild(cell)		
				}
				// add the Direction dropdown
				else if (i == 1) {
					direction = $("#direction1").clone().attr("id","direction" + last_chq_no);
					direction.attr("id", "direction" + new_chq_no);
					const cellOne = document.createElement(i ? "td" : "th")
					direction.appendTo(cellOne);
					row.appendChild(cellOne)
				}
				// add the CallPut dropdown
				else if (i == 2) {
					callPut = $("#CallPut1").clone().attr("id","CallPut" + last_chq_no);
					callPut.attr("id", "CallPut" + new_chq_no);
					const cellTwo = document.createElement(i ? "td" : "th")
					callPut.appendTo(cellTwo);
					row.appendChild(cellTwo)
				}
				// add textboxes from row 2 until last row in table
				else {
	  				k++;
	  				const input = document.createElement("input")
	  				input.setAttribute("id", (rowCount * (new_chq_no - 2)) + (k - 1), "class", "secure");
	    			const cell = document.createElement(i ? "td" : "th")
	    			cell.appendChild(input)   
	    			row.appendChild(cell)
				}
    			
  		}
		}
}

</script> 

<head>
  <script type="text/javascript">
	var i,j,k;
	i = 400;
	j = 500;
	k = j - i;
	
	//last_chq_no is the current number of inputboxes
	
  window.onload = function () {
    var chart = new CanvasJS.Chart("chartContainer",
    {

      title:{
      text: "PnL at Expiry"
      },
      axisX:{
          title: "Axis X with maximum 610",
        minimum: 1.10,
        maximum: 1.18
       },
       data: [
      {
        type: "line",

        dataPoints: [
        { x: 1.05, y: 150 },
        { x: 1.06, y: 200 },
        { x: 1.07, y: 500}
        ]
      }
      ]
    });

    chart.render();
    
	$("#updateDataPoint").click(function () {

		var firstPointX = document.getElementById("spotMin").value;
		var firstPointValueX = parseFloat(firstPointX);
		
		var Notional = document.getElementById("3").value;
		var NotionalFloat = parseFloat(Notional);
		
		var secondPointX = document.getElementById("4").value;
		var secondPointValueX = parseFloat(secondPointX);
			
		var lastPointX = document.getElementById("spotMax").value;
		var lastPointValueX = parseFloat(lastPointX);
				
		var optionValue = document.getElementById(6).value;
		var optionValueFloat = parseFloat(optionValue) * -1;
		
		var firstPointY = Math.max(firstPointValueX - secondPointValueX, 0) + optionValueFloat;
		var secondPointY = Math.max(secondPointValueX - secondPointValueX, 0) + optionValueFloat;
		var lastPointY = (lastPointValueX * (NotionalFloat)/secondPointValueX) - NotionalFloat  + optionValueFloat;
		
		var length = chart.options.data[0].dataPoints.length;
		chart.options.data[0].dataPoints[0].x = firstPointValueX;
		chart.options.data[0].dataPoints[1].x = secondPointValueX;
		chart.options.data[0].dataPoints[length-1].x = lastPointValueX;
		chart.options.data[0].dataPoints[0].y = firstPointY;
		chart.options.data[0].dataPoints[1].y = secondPointY;
		chart.options.data[0].dataPoints[length-1].y = lastPointY;
		chart.render();

		}); 
  }
  </script>
 <script type="text/javascript" src="https://canvasjs.com/assets/script/canvasjs.min.js"></script></head>
<body>
  <div id="chartContainer" style="height: 300px; width: 100%;">
  </div>

</body>
</html>
